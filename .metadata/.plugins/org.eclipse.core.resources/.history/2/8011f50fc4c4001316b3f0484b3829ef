package com.example.bump.serveur;

import java.net.InetAddress;
import java.net.UnknownHostException;

import com.example.bump.actions.*;

public class Parseur {
	
	public static Transmissible parser(byte[] recu) {
        switch (recu[0]) {
            case 0 : return lireBF(recu);
            case 1 : return lireColor(recu);

            case 2 : return lireConnexion(recu);

            case 3 : return lireMessage(recu);

            case 4 : return lireTransmission(recu);
            
            case 5 : return lireIdentifiant(recu);
            
            case 6 : return lireIdentifiantAnswer(recu);
            
            case 7 : return lireMenu(recu);
            
            case 8 : return lireCommande(recu);
            
            case 9 : return lireRequestMoney(recu);
            
            case 10 : return lireMoney(recu);

            default : System.out.println("Classe recue non reconnue.");
                return null;
        }
    }

    private static Transmissible lireMoney(byte[] recu) {
		return (Transmissible) (new Money(recu[1]));
	}

	private static Transmissible lireRequestMoney(byte[] recu) {
		return (Transmissible) (new RequestMoney());
	}

	private static Transmissible lireCommande(byte[] recu) {
		// TODO Auto-generated method stub
		return null;
	}

	private static Transmissible lireMenu(byte[] recu) {
		// TODO Auto-generated method stub
		return null;
	}

	private static Transmissible lireIdentifiantAnswer(byte[] recu) {
		// TODO Auto-generated method stub
		return null;
	}

	private static Transmissible lireIdentifiant(byte[] recu) {
		// TODO Auto-generated method stub
		return null;
	}

	private static Transmissible lireBF(byte[] recu) {
        StringBuilder str1 = new StringBuilder();
        StringBuilder str2 = new StringBuilder();
        int n = recu.length;
        int i = 1;
        while (recu[i] != '|') {
            str1.append((char)recu[i]);
            i++;
        }
        i++;
        for (;i<n;i++) {
            str2.append((char)recu[i]);
        }
        try {
            return (Transmissible) new BumpFriend(str1.toString(), InetAddress.getByName(str2.toString()));
        } catch (UnknownHostException e) {
            e.printStackTrace();
            return null;
        }
    }

    private static Transmissible lireColor (byte[] recu) {
        return (Transmissible) new Color (recu[1],recu[2],recu[3]);
    }

    private static Transmissible lireConnexion(byte[] recu) {
        StringBuilder str1 = new StringBuilder();
        int i = 1;
        while (recu[i] != '|') {
            str1.append((char)recu[i]);
            i++;
        }
        i++;
        try {
            return (Transmissible) new Connexion(recu[i],recu[i+1],InetAddress.getByName(str1.toString()));
        } catch (UnknownHostException e) {
            e.printStackTrace();
            return null;
        }
    }

    private static Transmissible lireMessage(byte[] recu) {
        StringBuilder str1 = new StringBuilder();
        StringBuilder str2 = new StringBuilder();
        int n = recu.length;
        int i = 1;
        while (recu[i] != '|') {
            str1.append((char)recu[i]);
            i++;
        }
        i++;
        for (;i<n;i++) {
            str2.append((char)recu[i]);
        }
        return new Message(str1.toString(),str2.toString());
    }

    private static Transmissible lireTransmission(byte[] recu) {
        int n = recu.length;
        boolean dialogueReussi;
        if (recu[1] == 1) dialogueReussi = true;
        else dialogueReussi = false;
        StringBuilder str = new StringBuilder();
        for (int i = 2; i < n ; i++) {
            str.append((char) recu[i]);
        }
        if ( n != 2) {
            return new Transmission(ErreurTransmission.valueOf(str.toString()));
        }
        else return new Transmission(dialogueReussi);
    }
}
